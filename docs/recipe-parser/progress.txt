2026-01-23 - Added server config validation for Clerk + Anthropic env vars and fail-fast startup guard.
2026-01-23 - Added recipe URL ingredients request/response/error types and Zod schemas for validation.
2026-01-23 - Added Clerk auth middleware to verify Bearer tokens and attach userId.
2026-01-23 - Switched auth middleware to `@clerk/express` clerkMiddleware/getAuth.
2026-01-23 - Added rate limiting middleware (30 req/min per user) with memory store and RateLimitStore abstraction for future Redis.
2026-01-23 - Added URL validation with SSRF protections using `request-filtering-agent` library. Basic URL validation in urlValidation.ts, SSRF protection at fetch level via the library.
2026-01-23 - Added HTML fetching with limits in htmlFetch.ts. Implements timeout (10s default), max size (2MB), redirect limit (5), SSRF protection via request-filtering-agent, content-type validation, and streaming body reader with size enforcement.
2026-01-23 - Added main content extraction in contentExtract.ts. Uses @mozilla/readability and linkedom to parse HTML, remove scripts/styles/nav/ads, and extract article content with fallback to cleaned body text.
2026-01-23 - Added Anthropic client wrapper in anthropicClient.ts. Uses @anthropic-ai/sdk with configurable timeouts (30s default), max retries (2 default), and request ID tracing. Includes typed error mapping (auth, rate limit, timeout, etc.) and built-in extraction prompt for ingredient parsing.
2026-01-23 - Added AI response parsing in aiExtract.ts. Parses raw JSON from Claude's response, validates against Zod schema, handles markdown code blocks, and exports typed AIExtraction result with AIExtractError for failures.
2026-01-23 - Added ingredient normalization in normalizeIngredients.ts. Standardizes units (e.g., "tablespoons" â†’ "tbsp"), lowercases ingredient names, normalizes whitespace, and handles null/empty values. Also set up vitest and added 49 unit tests for normalization edge cases (fractions, unit variations, whitespace, nulls).
2026-01-23 - Added API route assembly in route.ts. Wired up POST /api/recipes/ingredients-from-url endpoint with Clerk auth middleware, rate limiting, Zod request validation, URL validation, HTML fetch, content extraction, Anthropic AI extraction, AI response parsing, and ingredient normalization. Includes error code mapping for standardized error responses. Updated server/index.ts to mount the route and add JSON body parser.
